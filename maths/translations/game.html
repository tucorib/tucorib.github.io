<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="fr" lang="fr" dir="ltr">

	<head>
		<meta charset="UTF-8">
		<title>Translations</title>
		<meta name="viewport" content="width=device-width, initial-scale=1">
		
		<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
		<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
		<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>
		<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous"></link>
		<script src="https://raw.githack.com/jcubic/jquery.resize/master/jquery.resize.js"></script>
		
		<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
		<link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/smoothness/jquery-ui.css">
		<style>
			.box {
				position: relative;
				width: 50%;		/* desired width */
			}
			.box:before {
				content: "";
				float: left;
				padding-top: 100%; 	/* initial ratio of 1:1*/
			}
		</style>
		
		<script>
			// Easter egg :)
			console.log(
`        .-"-.
      .'=^=^='.
     /=^=^=^=^=\\
    :^= HAPPY =^;
    |^ EASTER! ^|
    :^=^=^=^=^=^:
     \=^=^=^=^=/
      \`.=^=^=.'
        \`~~~\`
`);
			
			var minxmax = 3;
			var	minymax = 3;
			var xmax = minxmax;
			var	ymax = minymax;
			var maxlives = 3;
			var score = 0;
			var combos = 0;
			var lives = maxlives;
			
			var setXmax = function(x){ xmax = x; $('#dropdownMenuButtonX').text(x); newGame(); };
			var setYmax = function(y){ ymax = y; $('#dropdownMenuButtonY').text(y); newGame(); };
			
			var newGame = function(){
				score = 0;
				combos = 0;
				xmax = minxmax;
				ymax = minymax;
				$('.score').text(score);
				$('.combos').text(combos);
				lives = maxlives;
				$('.life').show();
				newRun();
			};
			
			var newRun = function(){
				var arena = $('#arena');
				arena.empty();
				
				var xa = Math.floor(Math.random() * xmax);
				var ya = Math.floor(Math.random() * ymax);
				
				var xb = 0;
				var yb = 0;
				do{
					xb = Math.floor(Math.random() * xmax);
					yb = Math.floor(Math.random() * ymax);
				} while(
					(xa==xb && ya==yb) ||
					(Math.abs(xa-xb)==xmax-1 && Math.abs(ya-yb)==ymax-1)
				)
				
				var xc = 0;
				var yc = 0;
				do{
					xc = Math.max(0, xa - xb) + Math.floor(Math.random() * (xmax - Math.abs(xb - xa)));
					
					yc = Math.max(0, ya - yb) + Math.floor(Math.random() * (ymax - Math.abs(yb - ya)));
				} while(
					(xa == xc && ya == yc) ||
					(xb == xc && yb == yc)
				)
				
				var xd = xc + xb - xa;
				var yd = yc + yb - ya;
				
				
				var clickHandler = function(x,y){
					if(x == xd && y == yd){
						combos += 1;
						score += Math.floor(combos*xmax*ymax*lives/maxlives);
						xmax +=1;
						ymax +=1;
						$('.score').text(score);
						$('.combos').text(combos);
						$('#modal-right').modal('show');
					}
					else{
						$('.life[data-life='+lives+']').toggle( "explode" );
						lives -= 1;
						combos = 0;
						$('.combos').text(combos);
						if(lives == 0){
							$('#modal-wrong').modal('show');
						}
						else{
							$(arena).effect( "shake" );
						}
					}
				};
				
				for(var y=0; y<ymax; y++){
					var row = $('<div>', { class: 'd-flex flex-row w-100' });
					
					for(var x=0; x<xmax; x++){
						var e = $('<div>', {
							class: function(){
								var c = 'm-1 box rounded';
								if(x == xa && y == ya){
									return c + ' btn-primary';
								}
								else if(x == xb && y == yb){
									return c + ' btn-danger';
								}
								else if(x == xc && y == yc){
									return c + ' btn-success';
								}
								else{
									return c + ' btn-secondary';
								}
							},
							html: '&nbsp;'
						})
						.attr('data-x', x)
						.attr('data-y', y)
						.css('width', 100/xmax + '%')
						.click(function(){
							clickHandler($(this).data('x'),$(this).data('y'));
						});
						
						$(row).append(e);
					}
					
					$(arena).append(row);
				}
			};
			
			$(document).ready(function(){
				for(var i=0; i<maxlives; i++){
					$('<img>', {
						src: 'https://cdn.pixabay.com/photo/2017/09/23/16/33/pixel-heart-2779422_960_720.png',
						class: 'life',
						width: '40px',
						height: '40px'
					})
					.attr('data-life', maxlives-i)
					.appendTo($('#lives'));
				}
			
				newGame();
			});
		</script>
	</head>
	
	<body>
		<div class="container">
			<div class="jumbotron">
				<h5 class="text-center">Sélectionne l'image du bouton <span class="badge badge-success">vert</span> par la translation qui transforme le bouton <span class="badge badge-primary">bleu</span> en bouton <span class="badge badge-danger">rouge</span></h5>
			</div>
			<div class="jumbotron">
				<div class="container-fluid">
					<h5><span>Score:</span> <span class="score">0</span> <span>points</span></h5>
				</div>
				<div class="container-fluid">
					<h5><span>Combos:</span> <span class="combos">0</span></h5>
				</div>
				<div class="container-fluid">
					<div id="lives" class="container-fluid flex-fill text-center"></div>
				</div>
			</div>
			
			<div id="arena" class="container"></div>
			
			<div id="modal-right" class="modal" tabindex="-1" role="dialog">
			  <div class="modal-dialog modal-lg modal-dialog-centered" role="document">
				<div class="modal-content">
				  <div class="modal-header">
					<h1 class="modal-title text-center">Bravo!</h1>
					<button type="button" class="close" data-dismiss="modal" aria-label="Close">
					  <span aria-hidden="true">&times;</span>
					</button>
				  </div>
				  <div class="modal-body">
					<h2 class="text-center">Bonne réponse!</h2>
				  </div>
				  <div class="modal-footer">
					<button type="button" class="btn btn-lg btn-secondary" data-dismiss="modal" onclick="newGame();">Recommencer</button>
					<button type="button" class="btn btn-lg btn-primary" data-dismiss="modal" onclick="newRun();">Continuer</button>
				  </div>
				</div>
			  </div>
			</div>
			
			<div id="modal-wrong" class="modal" tabindex="-1" role="dialog">
			  <div class="modal-dialog modal-lg modal-dialog-centered" role="document">
				<div class="modal-content">
				  <div class="modal-header">
					<h1 class="modal-title text-center">Fin de la partie</h1>
					<button type="button" class="close" data-dismiss="modal" aria-label="Close">
					  <span aria-hidden="true">&times;</span>
					</button>
				  </div>
				  <div class="modal-body">
					<h2 class="text-center">Tu as fais: <span class="score font-weight-bold"></span> points!</h2>
				  </div>
				  <div class="modal-footer">
					<button type="button" class="btn btn-lg btn-secondary" data-dismiss="modal" onclick="newGame();">Recommencer</button>
				  </div>
				</div>
			  </div>
			</div>
		</div>
		
	</body>
</html>
